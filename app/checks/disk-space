#!/bin/bash

if [[ ! "${DIR}" ]] || [[ ! "${MIN_REQ_SPACE}" ]]; then
    echo "Missing one of parameters: DIR, MIN_REQ_SPACE"
    exit 1
fi

df_output=$(df -h ${DIR} --output=size)

if [[ "${MOCK_DF_OUTPUT}" ]]; then
    df_output="${MOCK_DF_OUTPUT}"
fi

space=$(echo ${df_output} | tail -n 1 | tr -d "[:space:]")
space=${space//,/.}

if [[ $(echo "${space}<${MIN_REQ_SPACE}" | bc -l) == "1" ]]; then
    echo "Failed asserting that ${space}GB is at least ${MIN_REQ_SPACE}GB at '${DIR}' mountpoint"
    exit 1
fi

echo "There is ${space}GB disk space at '${DIR}', nothing to worry about, defined minimum is ${MIN_REQ_SPACE}GB"

exit 0
